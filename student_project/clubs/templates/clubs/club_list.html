{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Clubs | Club Management System</title>

    {% if user.profile.role == 'student' %}
        <link rel="stylesheet" href="{% static 'css/student_dashboard.css' %}?v=3">
    {% else %}
        <link rel="stylesheet" href="{% static 'css/lecturer_dashboard.css' %}?v=1">
    {% endif %}
    <link rel="stylesheet" href="{% static 'css/club_list.css' %}">
</head>

<body>
<div class="dashboard-wrapper">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-section">
                <span class="logo-icon">ğŸ“</span>
                <span class="logo-text">CLUB MS</span>
            </div>
        </div>

        <div class="user-profile">
            {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="{{ user.profile.name }}" class="sidebar-avatar">
            {% else %}
                <img src="{% static 'images/default-avatar.png' %}" alt="Default Avatar" class="sidebar-avatar">
            {% endif %}

            <h3>{{ user.profile.name }}</h3>

            <!-- âœ… FIXED: proper spacing around == and elif -->
            <p class="sidebar-role"
               {% if user.profile.role == 'admin' %}
                   style="color: #e74c3c;"
               {% elif user.profile.role == 'lecturer' %}
                   style="color: #2980b9;"
               {% elif user.profile.role == 'student' %}
                   style="color: #27ae60;"
               {% else %}
                   style="color: #7f8c8d;"
               {% endif %}>
                {{ user.profile.role|title }}
            </p>
        </div>

        <nav class="sidebar-nav">
            <ul>
                {% if user.profile.role == 'student' %}
                    <li><a href="{% url 'student_dashboard' %}"><span class="nav-icon">ğŸ </span> Home</a></li>
                    <li><a href="{% url 'club_list' %}" class="active"><span class="nav-icon">ğŸ›</span> View Clubs</a></li>
                    <li><a href="{% url 'my_activity' %}"><span class="nav-icon">ğŸ“Š</span> My Activity</a></li>
                    <li><a href="{% url 'events_list' %}"><span class="nav-icon">ğŸ“…</span> Events</a></li>
                    <li><a href="{% url 'student_points' %}"><span class="nav-icon">ğŸ†</span> My Points</a></li>
                    <li><a href="{% url 'grade_panel' %}"><span class="nav-icon">ğŸ“ˆ</span> Grades</a></li>
                    <li><a href="{% url 'send_feedback' %}"><span class="nav-icon">ğŸ’¬</span> Send Feedback</a></li>

                {% elif user.profile.role == 'lecturer' %}
                    <li><a href="{% url 'lecturer_dashboard' %}"><span class="nav-icon">ğŸ </span> Dashboard</a></li>
                    <li><a href="{% url 'club_list' %}" class="active"><span class="nav-icon">ğŸ›</span> View Clubs</a></li>
                    <li><a href="{% url 'create_poll' %}"><span class="nav-icon">ğŸ—³ï¸</span> Create Poll</a></li>
                    <li><a href="{% url 'lecturer_add_mark' %}"><span class="nav-icon">ğŸ“</span> Add Student Marks</a></li>
                    <li><a href="{% url 'announcements' %}"><span class="nav-icon">ğŸ“¢</span> Announcements</a></li>
                    <li><a href="{% url 'reports' %}"><span class="nav-icon">ğŸ“Š</span> Reports</a></li>

                {% elif user.profile.role == 'admin' %}
                    <li><a href="{% url 'admin_dashboard' %}"><span class="nav-icon">ğŸ </span> Dashboard</a></li>
                    <li><a href="{% url 'manage_clubs' %}" class="active"><span class="nav-icon">ğŸ›</span> Manage Clubs</a></li>
                    <li><a href="{% url 'manage_users' %}"><span class="nav-icon">ğŸ‘¥</span> Manage Users</a></li>
                    <li><a href="{% url 'manage_posts' %}"><span class="nav-icon">ğŸ“</span> Manage Posts</a></li>
                    <li><a href="{% url 'system_reports' %}"><span class="nav-icon">ğŸ“Š</span> System Reports</a></li>
                    <li><a href="{% url 'admin_settings' %}"><span class="nav-icon">âš™ï¸</span> Settings</a></li>
                {% endif %}

                <li>
                    <form id="logout-form" action="{% url 'logout' %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="sidebar-link-btn">
                            <span class="nav-icon">ğŸšª</span> Logout
                        </button>
                    </form>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
        <header class="top-header">
            <div class="header-left">
                <button class="menu-toggle">â˜°</button>
                <h1 class="page-title">Club Management System | All Clubs</h1>
            </div>
            <div class="header-right">
                {% if user.profile.role == 'student' %}
                    <a href="{% url 'student_dashboard' %}" class="btn-back">â† Back to Dashboard</a>
                {% elif user.profile.role == 'lecturer' %}
                    <a href="{% url 'lecturer_dashboard' %}" class="btn-back">â† Back to Dashboard</a>
                {% elif user.profile.role == 'admin' %}
                    <a href="{% url 'admin_dashboard' %}" class="btn-back">â† Back to Dashboard</a>
                {% endif %}
            </div>
        </header>

        <div class="dashboard-content">

            <!-- Breadcrumb -->
            <div class="breadcrumb">
                {% if user.profile.role == 'student' %}
                    <a href="{% url 'student_dashboard' %}">Student</a>
                {% elif user.profile.role == 'lecturer' %}
                    <a href="{% url 'lecturer_dashboard' %}">Lecturer</a>
                {% elif user.profile.role == 'admin' %}
                    <a href="{% url 'admin_dashboard' %}">Admin</a>
                {% endif %}
                <span class="separator">></span>
                <span class="current">All Clubs</span>
            </div>

            <!-- Page Header -->
            <div class="page-header">
                <div class="header-content">
                    <h1>
                        {% if user.profile.role == 'student' %}
                            Discover Clubs
                        {% elif user.profile.role == 'admin' %}
                            Manage Clubs
                        {% else %}
                            All Clubs
                        {% endif %}
                    </h1>
                    <p>
                        {% if user.profile.role == 'student' %}
                            Browse and join clubs that match your interests
                        {% elif user.profile.role == 'admin' %}
                            Oversee and manage all student clubs
                        {% else %}
                            View and monitor all student clubs
                        {% endif %}
                    </p>
                </div>
                <div class="header-stats">
                    <div class="stat-badge">
                        <span class="stat-number">{{ clubs.count }}</span>
                        <span class="stat-label">Total Clubs</span>
                    </div>
                    {% if user.profile.role == 'student' %}
                        <div class="stat-badge">
                            <span class="stat-number">{{ user_clubs_count|default:0 }}</span>
                            <span class="stat-label">Joined</span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Search and Filter -->
            <section class="filter-section">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ğŸ” Search clubs by name..." onkeyup="filterClubs()">
                </div>
                {% if user.profile.role == 'student' %}
                    <div class="filter-actions">
                        <button class="filter-btn active" onclick="filterByStatus('all')">All Clubs</button>
                        <button class="filter-btn" onclick="filterByStatus('joined')">My Clubs</button>
                        <button class="filter-btn" onclick="filterByStatus('available')">Available</button>
                    </div>
                {% endif %}
            </section>

            <!-- Clubs Grid -->
            <section class="clubs-grid">
                {% for club in clubs %}
                    <div class="club-card" data-status="{% if user in club.members.all %}joined{% else %}available{% endif %}">
                        <div class="club-card-header">
                            <div class="club-icon">ğŸ›</div>
                            {% if user.profile.role == 'student' and user in club.members.all %}
                                <span class="member-badge">Member</span>
                            {% endif %}
                        </div>

                        <div class="club-card-body">
                            <h3 class="club-name">{{ club.name }}</h3>
                            <p class="club-description">{{ club.description|truncatewords:20 }}</p>
                            <div class="club-stats-row">
                                <span class="stat-item"><strong>{{ club.members.count }}</strong> Members</span>
                                <span class="stat-item"><strong>{{ club.posts.count }}</strong> Posts</span>
                            </div>
                        </div>

                        <div class="club-card-footer">
                            <a href="{% url 'club_detail' club.id %}" class="btn btn-view">View Details</a>

                            {% if user.profile.role == 'student' %}
                                <form method="post" action="{% url 'toggle_membership' club.id %}?next=club_list" style="display:inline;">
                                    {% csrf_token %}
                                    {% if user in club.members.all %}
                                        <button type="submit" class="btn btn-leave">Leave</button>
                                    {% else %}
                                        <button type="submit" class="btn btn-join">Join</button>
                                    {% endif %}
                                </form>

                            {% elif user.profile.role == 'admin' %}
                                <a href="{% url 'manage_clubs' %}" class="btn" style="background:#e74c3c;color:white;">Manage</a>
                            {% endif %}
                        </div>
                    </div>
                {% empty %}
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ›</div>
                        <h2>No Clubs Available</h2>
                        <p>There are currently no clubs to display.</p>
                    </div>
                {% endfor %}
            </section>

            <div id="noResults" class="no-results" style="display:none;">
                <div class="empty-icon">ğŸ”</div>
                <h2>No Clubs Found</h2>
                <p>Try adjusting your search or filters</p>
            </div>
        </div>
    </main>
</div>

<script>
    function filterClubs() {
        const input = document.getElementById('searchInput');
        const filter = input.value.toLowerCase();
        const cards = document.querySelectorAll('.club-card');
        let visibleCount = 0;

        cards.forEach(card => {
            const clubName = card.querySelector('.club-name').textContent.toLowerCase();
            const clubDesc = card.querySelector('.club-description').textContent.toLowerCase();

            if (clubName.includes(filter) || clubDesc.includes(filter)) {
                const activeBtn = document.querySelector('.filter-btn.active');
                if (activeBtn) {
                    const currentFilter = activeBtn.textContent.toLowerCase();
                    const cardStatus = card.getAttribute('data-status');
                    if (currentFilter === 'all clubs' ||
                        (currentFilter === 'my clubs' && cardStatus === 'joined') ||
                        (currentFilter === 'available' && cardStatus === 'available')) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                } else {
                    card.style.display = 'block';
                    visibleCount++;
                }
            } else {
                card.style.display = 'none';
            }
        });

        document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
    }

    function filterByStatus(status) {
        const cards = document.querySelectorAll('.club-card');
        const buttons = document.querySelectorAll('.filter-btn');
        let visibleCount = 0;

        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        cards.forEach(card => {
            const cardStatus = card.getAttribute('data-status');
            if (status === 'all' || cardStatus === status) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
        document.getElementById('searchInput').value = '';
    }
</script>
</body>
</html>
